import{j as e,m as j}from"./motion-Nujmgg1Y.js";import{r as x}from"./vendor-DJ1oPbzn.js";import{a as K,i as q,b as J,r as z,s as X,g as I}from"./dataLoader-oWN11X4O.js";import Z from"./DataDebugger-C8cLstNP.js";import{W as ee,D as se,b as B,c as te,R as F,T as Y,A as ae,d as re,e as le,a as ie,B as ne,f as ce}from"./icons-CYvmV9N1.js";function oe({onRefresh:D}){const[N,S]=x.useState(!1),[E,u]=x.useState("N/A"),[g,$]=x.useState(K()),[T,k]=x.useState(q()),A=async()=>{const b=await J();u(b||"N/A")},L=async()=>{S(!0);try{await z(),await A(),D==null||D()}catch(b){console.error("Failed to refresh data:",b)}finally{S(!1)}};return x.useEffect(()=>{T||(X(),k(!0),$(K()))},[T]),x.useEffect(()=>{A()},[]),e.jsxs(j.div,{className:"bg-white rounded-lg shadow-sm border p-4 mb-6",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[g.mode==="realtime"?e.jsx(ee,{className:"w-5 h-5 text-green-600"}):e.jsx(se,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:g.mode==="realtime"?"实时数据":"静态数据"}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center",children:[e.jsx(B,{className:"w-3 h-3 mr-1"}),E]})]})]}),g.available&&e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse mr-2"}),e.jsx("span",{className:"text-sm font-medium",children:"实时模式已启用"})]})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[!g.available&&e.jsxs("div",{className:"flex items-center text-amber-600 text-sm",children:[e.jsx(te,{className:"w-4 h-4 mr-1"}),"需要配置API密钥"]}),e.jsxs(j.button,{onClick:L,disabled:N,className:"flex items-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(F,{className:`w-4 h-4 mr-2 ${N?"animate-spin":""}`}),N?"刷新中...":"刷新数据"]})]})]}),g.mode==="realtime"&&e.jsx("div",{className:"mt-3 p-2 bg-green-50 rounded text-sm text-green-800",children:"✅ 实时模式已启用，数据将自动从Notion API获取最新内容，每3分钟自动刷新"}),!g.available&&e.jsx("div",{className:"mt-3 p-2 bg-red-50 rounded text-sm text-red-800",children:"❌ 实时模式不可用，请在 .env.local 文件中配置 VITE_NOTION_API_KEY 和数据库ID"})]})}const ue=()=>{const[D,N]=x.useState([]),[S,E]=x.useState([]),[u,g]=x.useState({mood:0,energy:0,sleep:0,meditation:0,exercise:0}),[$,T]=x.useState([]),[k,A]=x.useState(!0),[L,b]=x.useState(null),[O,Q]=x.useState(0),G=async()=>{A(!0),b(null),await z(),Q(a=>a+1)};x.useEffect(()=>{(async()=>{try{b(null);const w=await I("行动库");if(Array.isArray(w)){const n=w.filter(s=>{var l,t,i,r,c,o;try{const d=(i=(t=(l=s==null?void 0:s.properties)==null?void 0:l.状态)==null?void 0:t.status)==null?void 0:i.name,h=(o=(c=(r=s==null?void 0:s.properties)==null?void 0:r.截止日期)==null?void 0:c.date)==null?void 0:o.start;return d!=="已完成"&&h}catch(d){return console.warn("Error filtering task item:",s,d),!1}}).map(s=>{var l,t,i,r,c,o,d,h,p,m,y,f,v,C,R,H;try{return{id:s.id||"",title:((r=(i=(t=(l=s.properties)==null?void 0:l.行动描述)==null?void 0:t.title)==null?void 0:i[0])==null?void 0:r.plain_text)||"未命名任务",priority:parseInt(((d=(o=(c=s.properties)==null?void 0:c.优先级)==null?void 0:o.select)==null?void 0:d.name)||"0"),deadline:((m=(p=(h=s.properties)==null?void 0:h.截止日期)==null?void 0:p.date)==null?void 0:m.start)||"",status:((v=(f=(y=s.properties)==null?void 0:y.状态)==null?void 0:f.status)==null?void 0:v.name)||"",type:((H=(R=(C=s.properties)==null?void 0:C.行动类型)==null?void 0:R.select)==null?void 0:H.name)||"其他"}}catch(W){return console.warn("Error processing task item:",s,W),null}}).filter(s=>s!==null).sort((s,l)=>l.priority-s.priority);N(n)}else console.warn("Action data is not an array:",w),N([]);const _=await I("每日日志");if(Array.isArray(_)){const n=_.filter(s=>{var l,t,i;try{const r=(i=(t=(l=s==null?void 0:s.properties)==null?void 0:l.日期)==null?void 0:t.date)==null?void 0:i.start;return r&&new Date(r).toDateString()===new Date().toDateString()}catch(r){return console.warn("Error filtering log item:",s,r),!1}}).map(s=>{var l,t,i,r,c,o,d,h,p,m,y,f,v,C;try{return{id:s.id||"",startTime:((i=(t=(l=s.properties)==null?void 0:l.开始时间)==null?void 0:t.date)==null?void 0:i.start)||"",endTime:((o=(c=(r=s.properties)==null?void 0:r.结束时间)==null?void 0:c.date)==null?void 0:o.start)||"",activity:((m=(p=(h=(d=s.properties)==null?void 0:d.活动名称)==null?void 0:h.title)==null?void 0:p[0])==null?void 0:m.plain_text)||"",duration:((f=(y=s.properties)==null?void 0:y.实际时长)==null?void 0:f.number)||0,valueScore:((C=(v=s.properties)==null?void 0:v.价值评分)==null?void 0:C.number)||0}}catch(R){return console.warn("Error processing log item:",s,R),null}}).filter(s=>s!==null).sort((s,l)=>new Date(l.startTime).getTime()-new Date(s.startTime).getTime());E(n)}else console.warn("Logs data is not an array:",_),E([]);const M=await I("健康日记"),P=await I("情绪记录"),U=await I("目标库");if(Array.isArray(U)){const n=new Date().getFullYear(),s=Math.floor((new Date().getMonth()+3)/3),l=U.filter(t=>{var i,r,c,o,d,h;try{const p=(c=(r=(i=t==null?void 0:t.properties)==null?void 0:i.状态)==null?void 0:r.status)==null?void 0:c.name,m=(h=(d=(o=t==null?void 0:t.properties)==null?void 0:o.时间跨度)==null?void 0:d.select)==null?void 0:h.name;return(p==="进行中"||p==="In Progress")&&(m===`${n}年`||m===`${n}Q${s}`||m==="本年"||m==="本季"||m==="季度目标")}catch(p){return console.warn("Error filtering goal item:",t,p),!1}}).map(t=>{var i,r,c,o,d,h,p,m,y,f;try{return{name:((o=(c=(r=(i=t.properties)==null?void 0:i.理想状态)==null?void 0:r.title)==null?void 0:c[0])==null?void 0:o.plain_text)||"未命名目标",progress:Math.round((((p=(h=(d=t.properties)==null?void 0:d.目标进度)==null?void 0:h.rollup)==null?void 0:p.number)||0)*100),timeSpan:((f=(y=(m=t.properties)==null?void 0:m.时间跨度)==null?void 0:y.select)==null?void 0:f.name)||""}}catch(v){return console.warn("Error processing goal item:",t,v),null}}).filter(t=>t!==null).slice(0,3);T(l)}else console.warn("Goals data is not an array:",U),T([]);if(Array.isArray(M)&&M.length>0)try{const n=M[0];g(s=>{var l,t,i,r,c,o;return{...s,sleep:((t=(l=n.properties)==null?void 0:l.睡眠评分)==null?void 0:t.number)||0,exercise:((r=(i=n.properties)==null?void 0:i.运动评分)==null?void 0:r.number)||0,meditation:((o=(c=n.properties)==null?void 0:c.冥想评分)==null?void 0:o.number)||0}})}catch(n){console.warn("Error processing health data:",n)}if(Array.isArray(P)&&P.length>0)try{const n=P[0];g(s=>{var l,t,i,r;return{...s,mood:((t=(l=n.properties)==null?void 0:l.情绪评分)==null?void 0:t.number)||0,energy:((r=(i=n.properties)==null?void 0:i.精力水平)==null?void 0:r.number)||0}})}catch(n){console.warn("Error processing emotion data:",n)}}catch(w){console.error("Error fetching execution center data:",w),b("数据加载失败，请检查网络连接或刷新页面重试"),N([]),E([]),T([])}finally{A(!1)}})()},[O]);const V=a=>{console.log("Toggle task:",a)};return k?e.jsx("div",{className:"animate-pulse bg-gray-100 rounded-lg h-96"}):L?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Y,{className:"w-5 h-5 text-red-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800",children:"数据加载失败"})]}),e.jsx("p",{className:"text-red-700 mb-4",children:L}),e.jsxs("button",{onClick:G,className:"flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"重新加载"]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(oe,{onRefresh:G}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[e.jsxs(j.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5},className:"lg:col-span-1 bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-600 mr-2"}),"今日行动"]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:D.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"暂无今日任务"}):D.map(a=>e.jsxs(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-start space-x-3 p-2 hover:bg-gray-50 rounded-lg cursor-pointer",onClick:()=>V(a.id),children:[e.jsx("div",{className:"mt-1",children:a.status==="已完成"?e.jsx(re,{className:"w-5 h-5 text-green-500"}):e.jsx(le,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm ${a.status==="已完成"?"line-through text-gray-400":""}`,children:a.title}),e.jsxs("div",{className:"flex items-center mt-1 text-xs text-gray-500",children:[e.jsxs("span",{className:`px-2 py-0.5 rounded-full ${a.priority>=4?"bg-red-100 text-red-700":a.priority>=3?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:["P",a.priority]}),e.jsx("span",{className:"ml-2",children:a.type})]})]})]},a.id))})]}),e.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"lg:col-span-2 bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(B,{className:"w-5 h-5 text-green-600 mr-2"}),"日志流"]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:S.length===0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center py-4 text-yellow-600 bg-yellow-50 rounded-lg",children:[e.jsx(Y,{className:"w-5 h-5 mr-2"}),e.jsx("span",{children:"今日暂无日志记录"})]}),e.jsx("div",{className:"text-xs text-gray-500 text-center",children:"点击下方查看数据状态详情"})]}):S.map(a=>e.jsx(j.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"border-l-4 border-green-500 pl-4 py-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800",children:a.activity}),e.jsxs("div",{className:"flex items-center mt-1 text-sm text-gray-600",children:[e.jsx(B,{className:"w-3 h-3 mr-1"}),e.jsxs("span",{children:[new Date(a.startTime).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),a.endTime&&` - ${new Date(a.endTime).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}`]}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsxs("span",{children:[a.duration,"分钟"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm font-semibold text-green-600",children:["价值 ",a.valueScore,"/5"]})})]})},a.id))})]}),e.jsxs(j.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},className:"lg:col-span-1 bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(ie,{className:"w-5 h-5 text-red-600 mr-2"}),"生命体征"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"今日心情"}),e.jsxs("span",{className:"text-sm font-semibold",children:[u.mood,"/10"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-pink-400 to-pink-600 h-2 rounded-full",style:{width:`${u.mood*10}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"今日精力"}),e.jsxs("span",{className:"text-sm font-semibold",children:[u.energy,"/10"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-yellow-400 to-yellow-600 h-2 rounded-full",style:{width:`${u.energy*10}%`}})})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-2",children:"💤"}),e.jsx("span",{children:"睡眠质量"})]}),e.jsxs("span",{className:"text-lg font-semibold text-blue-600",children:[u.sleep,"/10"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mr-2",children:e.jsx(ne,{className:"w-4 h-4 text-purple-600"})}),e.jsx("span",{children:"冥想评分"})]}),e.jsxs("span",{className:"text-lg font-semibold text-purple-600",children:[u.meditation,"/10"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mr-2",children:e.jsx(ce,{className:"w-4 h-4 text-green-600"})}),e.jsx("span",{children:"运动评分"})]}),e.jsxs("span",{className:"text-lg font-semibold text-green-600",children:[u.exercise,"/10"]})]})]}),$.length>0&&e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"核心目标"}),$.map((a,w)=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"text-xs text-gray-600 flex-1 mr-2",children:a.name}),e.jsxs("span",{className:"text-xs font-semibold text-indigo-600",children:[a.progress,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-gradient-to-r from-indigo-400 to-indigo-600 h-1.5 rounded-full",style:{width:`${a.progress}%`}})}),e.jsx("span",{className:"text-xs text-gray-500",children:a.timeSpan})]},w))]})]})]}),S.length===0&&e.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"lg:col-span-4 mt-6",children:e.jsx(Z,{})})]})]})};export{ue as default};
