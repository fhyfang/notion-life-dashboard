import{j as e,m as _}from"./motion-CtNUML8-.js";import{r as j}from"./vendor-DJ1oPbzn.js";import{g as x}from"./index-B9mZRE9N.js";import{q,a as z,p as G}from"./icons-CbvDa_dU.js";import{R as J,P as Q,e as V,f as X,T as Z}from"./charts-Cp_LfCcJ.js";const ee=n=>{n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())),n.setUTCDate(n.getUTCDate()+4-(n.getUTCDay()||7));const i=new Date(Date.UTC(n.getUTCFullYear(),0,1));return Math.ceil(((n.getTime()-i.getTime())/864e5+1)/7)},te=()=>{const n=new Date,i=new Date(n.getFullYear(),n.getMonth(),n.getDate()),d=i.getDay(),p=new Date(i);p.setDate(i.getDate()-d-7);const h=new Date(i);return h.setDate(i.getDate()-d-1),h.setHours(23,59,59,999),{start:p,end:h}},w=({title:n,children:i,icon:d,color:p})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 h-full",children:[e.jsxs("div",{className:`flex items-center mb-3 ${p}`,children:[e.jsx(d,{className:"w-5 h-5 mr-2"}),e.jsx("h3",{className:"text-md font-bold",children:n})]}),i]}),C=["#0088FE","#00C49F","#FFBB28","#FF8042","#AF19FF"],le=()=>{var N,D,y,v,F;const[n,i]=j.useState({}),[d,p]=j.useState(!0),h=new Date,W=h.getFullYear(),E=ee(h)-1;return j.useEffect(()=>{(async()=>{p(!0);const{start:c,end:m}=te(),[T,S,A,R,O,U,K]=await Promise.all([x("健康日记"),x("情绪记录"),x("每日日志"),x("行动库"),x("财务记录"),x("知识库"),x("互动记录")]),g=T.filter(t=>{var s,a,r,o;return new Date((a=(s=t.properties.日期)==null?void 0:s.date)==null?void 0:a.start)>=c&&new Date((o=(r=t.properties.日期)==null?void 0:r.date)==null?void 0:o.start)<=m}),k=S.filter(t=>{var s,a,r,o;return new Date((a=(s=t.properties.日期)==null?void 0:s.date)==null?void 0:a.start)>=c&&new Date((o=(r=t.properties.日期)==null?void 0:r.date)==null?void 0:o.start)<=m}),L=A.filter(t=>{var s,a,r,o;return new Date((a=(s=t.properties.日期)==null?void 0:s.date)==null?void 0:a.start)>=c&&new Date((o=(r=t.properties.日期)==null?void 0:r.date)==null?void 0:o.start)<=m}),P=R.filter(t=>{var s,a,r,o,l,u;return((a=(s=t.properties.完成日期)==null?void 0:s.date)==null?void 0:a.start)&&new Date((o=(r=t.properties.完成日期)==null?void 0:r.date)==null?void 0:o.start)>=c&&new Date((u=(l=t.properties.完成日期)==null?void 0:l.date)==null?void 0:u.start)<=m}),Y=O.filter(t=>{var s,a,r,o;return new Date((a=(s=t.properties.日期)==null?void 0:s.date)==null?void 0:a.start)>=c&&new Date((o=(r=t.properties.日期)==null?void 0:r.date)==null?void 0:o.start)<=m}),M=U.filter(t=>new Date(t.created_time)>=c&&new Date(t.created_time)<=m),$=K.filter(t=>{var s,a,r,o;return new Date((a=(s=t.properties.日期)==null?void 0:s.date)==null?void 0:a.start)>=c&&new Date((o=(r=t.properties.日期)==null?void 0:r.date)==null?void 0:o.start)<=m}),I=g.reduce((t,s)=>{var a;return t+(((a=s.properties.睡眠时长)==null?void 0:a.number)||0)},0)/(g.length||1)/60,B=new Set(g.filter(t=>{var s;return(((s=t.properties.运动时长)==null?void 0:s.number)||0)>0}).map(t=>{var s,a;return(a=(s=t.properties.日期)==null?void 0:s.date)==null?void 0:a.start})).size,b={};L.forEach(t=>{var r,o,l,u;const s=((o=(r=t.properties.活动类别)==null?void 0:r.select)==null?void 0:o.name)||"未分类",a=((u=(l=t.properties["实际时长（分钟）"])==null?void 0:l.formula)==null?void 0:u.number)||0;b[s]=(b[s]||0)+a});const H=Y.reduce((t,s)=>{var r,o,l;const a=((r=s.properties.金额)==null?void 0:r.number)||0;return((l=(o=s.properties.类型)==null?void 0:o.select)==null?void 0:l.name)==="收入"?t+a:t-a},0);i({avgSleep:I.toFixed(1),exerciseDays:B,avgEnergy:(g.reduce((t,s)=>{var a,r;return t+(((r=(a=s.properties.精力水平)==null?void 0:a.formula)==null?void 0:r.number)||0)},0)/(g.length||1)).toFixed(0),moodExtremes:{high:k.sort((t,s)=>{var a,r,o,l;return(((r=(a=s.properties.当前心情评分)==null?void 0:a.select)==null?void 0:r.name)||"0").localeCompare(((l=(o=t.properties.当前心情评分)==null?void 0:o.select)==null?void 0:l.name)||"0")})[0],low:k.sort((t,s)=>{var a,r,o,l;return(((r=(a=t.properties.当前心情评分)==null?void 0:a.select)==null?void 0:r.name)||"0").localeCompare(((l=(o=s.properties.当前心情评分)==null?void 0:o.select)==null?void 0:l.name)||"0")})[0]},timeAllocation:Object.entries(b).map(([t,s])=>({name:t,value:Math.round(s/60)})),actionsCompleted:P.length,netFinancial:H.toFixed(2),newKnowledge:M.length,importantInteractions:$.length}),p(!1)})()},[]),d?e.jsx("div",{className:"text-center p-8",children:"生成周度复盘报告中..."}):e.jsxs(_.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800",children:[W," W",E," - 每周回顾与规划"]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-4",children:"第一部分：上周数据快照"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(w,{title:"基座与能量",icon:q,color:"text-blue-600",children:e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("p",{children:["平均睡眠: ",e.jsxs("span",{className:"font-bold",children:[n.avgSleep,"h"]})]}),e.jsxs("p",{children:["运动天数: ",e.jsxs("span",{className:"font-bold",children:[n.exerciseDays," 天"]})]}),e.jsxs("p",{children:["平均精力: ",e.jsxs("span",{className:"font-bold",children:[n.avgEnergy,"/100"]})]}),e.jsxs("p",{className:"border-t pt-2 mt-2",children:["高光情绪: ",e.jsx("span",{className:"font-semibold",children:((N=n.moodExtremes)==null?void 0:N.high)&&getPlainText((D=n.moodExtremes.high.properties.记录标题)==null?void 0:D.title)})]}),e.jsxs("p",{children:["低谷情绪: ",e.jsx("span",{className:"font-semibold",children:((y=n.moodExtremes)==null?void 0:y.low)&&getPlainText((v=n.moodExtremes.low.properties.记录标题)==null?void 0:v.title)})]})]})}),e.jsxs(w,{title:"时间与目标投入",icon:z,color:"text-green-600",children:[e.jsx(J,{width:"100%",height:150,children:e.jsxs(Q,{children:[e.jsx(V,{data:n.timeAllocation,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:30,outerRadius:50,paddingAngle:5,children:(F=n.timeAllocation)==null?void 0:F.map((f,c)=>e.jsx(X,{fill:C[c%C.length]},`cell-${c}`))}),e.jsx(Z,{formatter:f=>`${f} 小时`})]})}),e.jsxs("p",{className:"text-center text-sm mt-2",children:["已完成行动: ",e.jsx("span",{className:"font-bold",children:n.actionsCompleted})," 项"]})]}),e.jsx(w,{title:"杠杆与资源积累",icon:G,color:"text-purple-600",children:e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("p",{children:["本周净收支: ",e.jsxs("span",{className:`font-bold ${n.netFinancial>0?"text-green-600":"text-red-600"}`,children:["¥",n.netFinancial]})]}),e.jsxs("p",{children:["新增知识点: ",e.jsx("span",{className:"font-bold",children:n.newKnowledge})," 个"]}),e.jsxs("p",{children:["重要互动: ",e.jsx("span",{className:"font-bold",children:n.importantInteractions})," 次"]})]})})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-4",children:"第二部分：洞察与反思 (So What?)"}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-green-600 mb-2",children:"✅ 本周成就 (Wins)"}),e.jsx("textarea",{className:"w-full h-32 p-2 border rounded bg-green-50 border-green-200 focus:ring-green-500 focus:border-green-500",placeholder:"记录下让你感到自豪的事情，无论大小..."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-red-600 mb-2",children:"🤔 本周挑战 (Challenges)"}),e.jsx("textarea",{className:"w-full h-32 p-2 border rounded bg-red-50 border-red-200 focus:ring-red-500 focus:border-red-500",placeholder:"遇到了哪些困难？哪些事情没有按计划进行？"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("h3",{className:"font-bold text-yellow-600 mb-2",children:"💡 核心洞察 (Key Learnings)"}),e.jsx("textarea",{className:"w-full h-24 p-2 border rounded bg-yellow-50 border-yellow-200 focus:ring-yellow-500 focus:border-yellow-500",placeholder:"从本周的经历中学到了什么最重要的教训？"})]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-4",children:"第三部分：下周规划 (Now What?)"}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h3",{className:"font-bold text-blue-600 mb-2",children:"🎯 下周三大聚焦 (Top 3 Focus Areas)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",className:"w-full p-2 border rounded focus:ring-blue-500 focus:border-blue-500",placeholder:"1. "}),e.jsx("input",{type:"text",className:"w-full p-2 border rounded focus:ring-blue-500 focus:border-blue-500",placeholder:"2. "}),e.jsx("input",{type:"text",className:"w-full p-2 border rounded focus:ring-blue-500 focus:border-blue-500",placeholder:"3. "})]})]})]})]})};export{le as default};
