import{j as e,m as X}from"./motion-Nujmgg1Y.js";import{r as f}from"./vendor-DJ1oPbzn.js";import{g as F}from"./dataLoader-oWN11X4O.js";import{Z as Y,A,h as Z,B as T}from"./icons-CYvmV9N1.js";import{R as K,L as _,X as S,Y as u,T as k,a as N,C as G,b as I,c as W,B as L,d as $}from"./charts-Cp_LfCcJ.js";const D=({title:p,children:w,icon:b,color:h})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(b,{className:"w-6 h-6 mr-3",style:{color:h}}),e.jsx("h3",{className:"text-lg font-bold",style:{color:h},children:p})]}),w]}),U=()=>{const[p,w]=f.useState([]),[b,h]=f.useState([]),[M,v]=f.useState(!0);return f.useEffect(()=>{(async()=>{v(!0);const B=await F("健康日记"),z=await F("情绪记录"),y=new Date;y.setDate(y.getDate()-30);const i=new Map;for(let t=0;t<30;t++){const a=new Date;a.setDate(a.getDate()-t);const s=a.toISOString().split("T")[0];i.set(s,{date:s,sleep:null,exercise:null,meditation:null,energy:null,mood:[]})}B.forEach(t=>{var s,l,d,c,m,x,g,j,n,E;const a=(l=(s=t.properties.日期)==null?void 0:s.date)==null?void 0:l.start;if(a&&new Date(a)>=y){const r=i.get(a)||{date:a,sleep:null,exercise:null,meditation:null,energy:null,mood:[]};r.sleep=((c=(d=t.properties.睡眠评分)==null?void 0:d.formula)==null?void 0:c.number)||r.sleep,r.exercise=((x=(m=t.properties.运动评分)==null?void 0:m.formula)==null?void 0:x.number)||r.exercise,r.meditation=((j=(g=t.properties.冥想评分)==null?void 0:g.formula)==null?void 0:j.number)||r.meditation,r.energy=((E=(n=t.properties.精力水平)==null?void 0:n.formula)==null?void 0:E.number)||r.energy,i.set(a,r)}});const C={};z.forEach(t=>{var s,l,d,c,m,x,g;const a=((l=(s=t.properties.日期)==null?void 0:s.date)==null?void 0:l.start)||new Date((d=t.properties.记录时间)==null?void 0:d.created_time).toISOString().split("T")[0];if(a&&new Date(a)>=y){const j=parseInt((((m=(c=t.properties.当前心情评分)==null?void 0:c.select)==null?void 0:m.name)||"0").replace(" 分",""));i.has(a)&&i.get(a).mood.push(j);const n=(g=(x=t.properties.触发类型)==null?void 0:x.select)==null?void 0:g.name;n&&(C[n]=(C[n]||0)+1)}}),i.forEach(t=>{t.mood.length>0?t.avgMood=t.mood.reduce((a,s)=>a+s,0)/t.mood.length:t.avgMood=null,delete t.mood});const O=Object.entries(C).map(([t,a])=>({name:t,count:a}));h(O);const R=Array.from(i.values()).map(({mood:t,...a})=>a).sort((t,a)=>new Date(t.date).getTime()-new Date(a.date).getTime());w(R),v(!1)})()},[]),M?e.jsx("div",{className:"text-center p-8",children:"加载分析数据中..."}):e.jsxs(X.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"能量分析仪表盘"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[{title:"精力水平",dataKey:"energy",color:"#3B82F6",icon:Y},{title:"运动评分",dataKey:"exercise",color:"#10B981",icon:A},{title:"睡眠评分",dataKey:"sleep",color:"#8B5CF6",icon:Z},{title:"冥想评分",dataKey:"meditation",color:"#EC4899",icon:T}].map(o=>e.jsx(D,{title:o.title,icon:o.icon,color:`text-[${o.color}]`,children:e.jsx(K,{width:"100%",height:150,children:e.jsxs(_,{data:p,margin:{top:5,right:20,left:-10,bottom:5},children:[e.jsx(S,{dataKey:"date",tick:{fontSize:10},tickFormatter:B=>new Date(B).getDate().toString()}),e.jsx(u,{}),e.jsx(k,{}),e.jsx(N,{type:"monotone",dataKey:o.dataKey,stroke:o.color,strokeWidth:2,dot:!1})]})})},o.title))}),e.jsx(D,{title:"健康-精力-情绪关联分析",icon:A,color:"text-green-600",children:e.jsx(K,{width:"100%",height:300,children:e.jsxs(G,{data:p,children:[e.jsx(I,{strokeDasharray:"3 3"}),e.jsx(S,{dataKey:"date",tick:{fontSize:12},tickFormatter:o=>new Date(o).toLocaleDateString("zh-CN",{month:"short",day:"numeric"})}),e.jsx(u,{yAxisId:"left"}),e.jsx(u,{yAxisId:"right",orientation:"right"}),e.jsx(k,{}),e.jsx(W,{}),e.jsx(L,{yAxisId:"left",dataKey:"avgMood",name:"平均心情",fill:"#FBBF24"}),e.jsx(N,{yAxisId:"right",type:"monotone",dataKey:"sleep",name:"睡眠评分",stroke:"#8B5CF6"}),e.jsx(N,{yAxisId:"right",type:"monotone",dataKey:"energy",name:"精力水平",stroke:"#3B82F6"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(D,{title:"情绪触发源分析",icon:T,color:"text-purple-600",children:e.jsx(K,{width:"100%",height:300,children:e.jsxs($,{data:b,layout:"vertical",children:[e.jsx(I,{strokeDasharray:"3 3"}),e.jsx(S,{type:"number"}),e.jsx(u,{type:"category",dataKey:"name",width:80,tick:{fontSize:12}}),e.jsx(k,{}),e.jsx(L,{dataKey:"count",name:"触发次数",fill:"#8B5CF6"})]})})}),e.jsx(D,{title:"高效恢复行动",icon:A,color:"text-orange-500",children:e.jsx("div",{className:"h-[300px] flex items-center justify-center text-gray-500",children:e.jsx("p",{children:"高效恢复行动排行榜模块正在建设中..."})})})]})]})};export{U as default};
