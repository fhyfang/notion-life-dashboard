import{j as e,m as G}from"./motion-CtNUML8-.js";import{r as h}from"./vendor-DJ1oPbzn.js";import{g}from"./index-B9mZRE9N.js";import{a as X,j as Y,k as T}from"./icons-CbvDa_dU.js";import{R as F,P as _,e as q,f as z,T as v,c as C,S as H,b as J,X as Q,Y as U,g as V,h as b}from"./charts-Cp_LfCcJ.js";const R=i=>(i==null?void 0:i.map(n=>n.plain_text).join(""))||"",N=({title:i,children:n,icon:j,color:y})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 h-full",children:[e.jsxs("div",{className:`flex items-center mb-4 ${y}`,children:[e.jsx(j,{className:"w-6 h-6 mr-3"}),e.jsx("h3",{className:"text-lg font-bold",children:i})]}),n]}),A=["#0088FE","#00C49F","#FFBB28","#FF8042","#AF19FF","#FF4560"],ae=()=>{const[i,n]=h.useState([]),[j,y]=h.useState([]),[S,k]=h.useState([]),[M,w]=h.useState(!0);return h.useEffect(()=>{(async()=>{w(!0);const[c,P,D,E]=await Promise.all([g("项目库"),g("目标库"),g("行动库"),g("每日日志")]),O=c.map(t=>{var o,p,m,d,x,l,u;const s=((p=(o=t.properties["总投入时长（分钟）"])==null?void 0:o.rollup)==null?void 0:p.number)||0,a=(((d=(m=t.properties.目标进度)==null?void 0:m.formula)==null?void 0:d.number)||0)*100;return{name:R((x=t.properties.项目名称)==null?void 0:x.title),duration:(s/60).toFixed(1),progress:a.toFixed(0),roi:s>0?(a/(s/60)).toFixed(2):0,status:(u=(l=t.properties.状态)==null?void 0:l.select)==null?void 0:u.name}}).filter(t=>t.status==="执行中");n(O);const I=new Map(P.map(t=>{var s,a;return[t.id,((a=(s=t.properties.领域)==null?void 0:s.select)==null?void 0:a.name)||"未分类"]})),K=new Map(c.map(t=>{var s,a;return[t.id,(a=(s=t.properties.关联目标)==null?void 0:s.relation[0])==null?void 0:a.id]})),L=new Map(D.map(t=>{var s,a;return[t.id,(a=(s=t.properties.关联项目)==null?void 0:s.relation[0])==null?void 0:a.id]})),f={};E.forEach(t=>{var a,o,p,m;const s=(o=(a=t.properties.关联行动)==null?void 0:a.relation[0])==null?void 0:o.id;if(s){const d=L.get(s);if(d){const x=K.get(d);if(x){const l=I.get(x);if(l){const u=((m=(p=t.properties["实际时长（分钟）"])==null?void 0:p.formula)==null?void 0:m.number)||0;f[l]=(f[l]||0)+u}}}}});const $=Object.entries(f).map(([t,s])=>({name:t,value:Math.round(s/60)}));y($);const B=D.filter(t=>{var s,a,o;return((s=t.properties.预估时长)==null?void 0:s.number)&&((o=(a=t.properties["实际投入时长（分钟）"])==null?void 0:a.rollup)==null?void 0:o.number)}).map(t=>{var s;return{name:R((s=t.properties.行动描述)==null?void 0:s.title),estimate:t.properties.预估时长.number,actual:t.properties["实际投入时长（分钟）"].rollup.number}});k(B),w(!1)})()},[]),M?e.jsx("div",{className:"text-center p-8",children:"加载时间分析数据中..."}):e.jsxs(G.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"时间分析仪表盘"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(N,{title:"时间分配概览",icon:X,color:"text-green-600",children:e.jsx(F,{width:"100%",height:300,children:e.jsxs(_,{children:[e.jsx(q,{data:j,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:100,label:!0,children:j.map((r,c)=>e.jsx(z,{fill:A[c%A.length]},`cell-${c}`))}),e.jsx(v,{formatter:r=>`${r} 小时`}),e.jsx(C,{})]})})}),e.jsx(N,{title:"预估-实际时长偏差",icon:Y,color:"text-yellow-600",children:e.jsx(F,{width:"100%",height:300,children:e.jsxs(H,{margin:{top:20,right:20,bottom:20,left:20},children:[e.jsx(J,{}),e.jsx(Q,{type:"number",dataKey:"estimate",name:"预估 (分钟)"}),e.jsx(U,{type:"number",dataKey:"actual",name:"实际 (分钟)"}),e.jsx(v,{cursor:{strokeDasharray:"3 3"}}),e.jsx(C,{}),e.jsx(V,{name:"行动",data:S,fill:"#f59e0b"}),e.jsx(b,{y:0,stroke:"#000"}),e.jsx(b,{x:0,stroke:"#000"}),e.jsx(b,{ifOverflow:"extendDomain",stroke:"red",strokeDasharray:"3 3",segment:[{x:0,y:0},{x:500,y:500}]})]})})})]}),e.jsx(N,{title:"项目投入产出比 (ROI)",icon:T,color:"text-blue-600",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-gray-500",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"项目名称"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"状态"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"总投入 (小时)"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"进度 (%)"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"ROI (进度/小时)"})]})}),e.jsx("tbody",{children:i.map(r=>e.jsxs("tr",{className:"bg-white border-b hover:bg-gray-50",children:[e.jsx("th",{scope:"row",className:"px-6 py-4 font-medium text-gray-900 whitespace-nowrap",children:r.name}),e.jsx("td",{className:"px-6 py-4",children:r.status}),e.jsx("td",{className:"px-6 py-4",children:r.duration}),e.jsxs("td",{className:"px-6 py-4",children:[r.progress,"%"]}),e.jsx("td",{className:`px-6 py-4 font-bold ${r.roi>10?"text-green-600":r.roi<2?"text-red-600":"text-yellow-600"}`,children:r.roi})]},r.name))})]})})})]})};export{ae as default};
