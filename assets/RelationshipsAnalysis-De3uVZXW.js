import{j as e,m as ee}from"./motion-CtNUML8-.js";import{r as x}from"./vendor-DJ1oPbzn.js";import{g as E}from"./index-B9mZRE9N.js";import{U as L,P as te,f as $}from"./icons-CbvDa_dU.js";import{R as f,P as B,e as I,f as M,T as y,c as w,S as se,b as U,X,Y,Z as ae,h as Z,g as re,d as ne,B as K}from"./charts-Cp_LfCcJ.js";const k=i=>(i==null?void 0:i.map(m=>m.plain_text).join(""))||"",u=({title:i,children:m,icon:D,color:C,subtitle:p})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 h-full flex flex-col",children:[e.jsxs("div",{className:`flex items-center mb-1 ${C}`,children:[e.jsx(D,{className:"w-6 h-6 mr-3"}),e.jsx("h3",{className:"text-lg font-bold",children:i})]}),p&&e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:p}),e.jsx("div",{className:"flex-grow",children:m})]}),b=["#0088FE","#00C49F","#FFBB28","#FF8042"],xe=()=>{const[i,m]=x.useState([]),[D,C]=x.useState([]),[p,G]=x.useState([]),[R,_]=x.useState([]),[q,z]=x.useState([]),[H,F]=x.useState(!0);return x.useEffect(()=>{(async()=>{F(!0);const[r,J]=await Promise.all([E("关系网"),E("财务记录")]),N={},Q={高度一致:5,高度互补:4,部分重叠:3,潜在机会:2,无关:1,潜在冲突:-1,竞争:-2},V=r.map(t=>{var a,o,n,c,d,j,g;const s=k((o=(a=t.properties.核心圈层)==null?void 0:a.formula)==null?void 0:o.string);return s&&(N[s]=(N[s]||0)+1),{name:k((n=t.properties.姓名)==null?void 0:n.title),myTrust:((c=t.properties.我信任对方)==null?void 0:c.number)||0,theirTrust:((d=t.properties["对方信任我(估)"])==null?void 0:d.number)||0,interestMatch:Q[(g=(j=t.properties.利益匹配度)==null?void 0:j.select)==null?void 0:g.name]||1}}),v=new Date;v.setDate(v.getDate()-90);const W=r.filter(t=>{var a,o,n,c,d;const s=(d=(c=(n=(o=(a=t.properties.最近联系)==null?void 0:a.rollup)==null?void 0:o.array)==null?void 0:n[0])==null?void 0:c.date)==null?void 0:d.start;return s?new Date(s)<v:!0}).map(t=>{var s;return k((s=t.properties.姓名)==null?void 0:s.title)});m(Object.entries(N).map(([t,s])=>({name:t,value:s}))),C(V),G(W);const h={},S={};J.forEach(t=>{var c,d,j,g,O,P,T;const s=(d=(c=t.properties.日期)==null?void 0:c.date)==null?void 0:d.start;if(!s)return;const a=new Date(s).toISOString().slice(0,7);h[a]||(h[a]={month:a,收入:0,支出:0,投资:0});const o=((j=t.properties.金额)==null?void 0:j.number)||0,n=(O=(g=t.properties.类型)==null?void 0:g.select)==null?void 0:O.name;if(n&&(h[a][n]=(h[a][n]||0)+o),n==="支出"){const A=((T=(P=t.properties["分类(支出)"])==null?void 0:P.select)==null?void 0:T.name)||"其他";S[A]=(S[A]||0)+o}}),z(Object.values(h).sort((t,s)=>t.month.localeCompare(s.month))),_(Object.entries(S).map(([t,s])=>({name:t,value:s}))),F(!1)})()},[]),H?e.jsx("div",{className:"text-center p-8",children:"加载关系与杠杆分析数据中..."}):e.jsxs(ee.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"关系构建与财务杠杆分析"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-700 mt-8 border-b-2 border-red-300 pb-2",children:"关系网络分析"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(u,{title:"关系圈层分布",icon:L,color:"text-red-600",children:e.jsx(f,{width:"100%",height:300,children:e.jsxs(B,{children:[e.jsx(I,{data:i,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,fill:"#8884d8",paddingAngle:5,label:!0,children:i.map((l,r)=>e.jsx(M,{fill:b[r%b.length]},`cell-${r}`))}),e.jsx(y,{}),e.jsx(w,{})]})})})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx(u,{title:"信任-利益四象限",icon:L,color:"text-red-600",subtitle:"点的大小代表利益匹配度",children:e.jsx(f,{width:"100%",height:300,children:e.jsxs(se,{margin:{top:20,right:20,bottom:20,left:20},children:[e.jsx(U,{}),e.jsx(X,{type:"number",dataKey:"myTrust",name:"我信任对方",unit:"/10",domain:[0,10]}),e.jsx(Y,{type:"number",dataKey:"theirTrust",name:"对方信任我(估)",unit:"/10",domain:[0,10]}),e.jsx(ae,{type:"number",dataKey:"interestMatch",range:[100,500],name:"利益匹配度"}),e.jsx(y,{cursor:{strokeDasharray:"3 3"}}),e.jsx(w,{}),e.jsx(Z,{x:5,stroke:"gray",strokeDasharray:"3 3"}),e.jsx(Z,{y:5,stroke:"gray",strokeDasharray:"3 3"}),e.jsx(re,{name:"联系人",data:D,fill:"#ef4444"})]})})})})]}),e.jsx(u,{title:"关系维护提醒 (90天未联系)",icon:te,color:"text-orange-500",children:p.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:p.map(l=>e.jsx("span",{className:"px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm",children:l},l))}):e.jsx("p",{className:"text-gray-500",children:"所有核心联系人近期都有互动，做得很好！"})}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-700 mt-8 border-b-2 border-green-300 pb-2",children:"财务健康度分析"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsx(u,{title:"收入/支出/投资趋势",icon:$,color:"text-green-600",children:e.jsx(f,{width:"100%",height:300,children:e.jsxs(ne,{data:q,children:[e.jsx(U,{strokeDasharray:"3 3"}),e.jsx(X,{dataKey:"month"}),e.jsx(Y,{}),e.jsx(y,{}),e.jsx(w,{}),e.jsx(K,{dataKey:"收入",stackId:"a",fill:"#22c55e"}),e.jsx(K,{dataKey:"支出",stackId:"a",fill:"#ef4444"}),e.jsx(K,{dataKey:"投资",stackId:"a",fill:"#3b82f6"})]})})})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(u,{title:"支出智慧分析",icon:$,color:"text-green-600",children:e.jsx(f,{width:"100%",height:300,children:e.jsxs(B,{children:[e.jsx(I,{data:R,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:100,fill:"#8884d8",labelLine:!1,label:({name:l,percent:r})=>`${l} ${(r*100).toFixed(0)}%`,children:R.map((l,r)=>e.jsx(M,{fill:b[r%b.length]},`cell-${r}`))}),e.jsx(y,{formatter:l=>`¥${Number(l).toLocaleString()}`})]})})})})]})]})};export{xe as default};
