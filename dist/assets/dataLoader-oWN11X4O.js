const c="/api";function s(){return{"Content-Type":"application/json"}}let o=null,n=0;const f=2*60*1e3;async function h(t){try{const e=await fetch(`${c}/database/${encodeURIComponent(t)}`,{method:"POST",headers:s()});if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);return(await e.json()).data}catch(e){return console.error(`Error fetching data for ${t}:`,e),[]}}async function l(){const t=Date.now();if(o&&t-n<f)return o;try{console.log("Fetching all databases from API server...");const e=await fetch(`${c}/databases`,{method:"GET",headers:s()});if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const r=await e.json();return o=r,n=t,console.log("Successfully loaded all databases:",Object.keys(r).length),r}catch(e){return console.error("Failed to load realtime data from API server:",e),o?(console.log("Returning expired cache data due to API error"),o):{}}}async function g(t){var e;try{return t==="每日日志"||t==="情绪记录"||t==="健康日记"?await h(t):((e=(await l())[t])==null?void 0:e.data)||[]}catch(r){return console.error(`Error getting realtime data for ${t}:`,r),[]}}function u(){o=null,n=0}function d(){return!0}let a=!1;function w(t){a=d(),a&&u()}function p(){return a}w();async function m(){if(a)try{return console.log("Loading realtime Notion data..."),await l()}catch(t){throw console.error("Realtime data loading failed:",t),t}throw new Error("Realtime mode is required for dynamic updates. Please check your API configuration.")}async function $(t){try{if(console.log(`Getting realtime data for database: ${t}`),a)try{return await g(t)}catch(e){throw console.error(`Realtime data fetch failed for ${t}:`,e),e}throw new Error(`Realtime mode is required for ${t}. Please check your API configuration.`)}catch(e){throw console.error(`Error getting database data for '${t}':`,e),e}}async function R(){var r;const t=await m(),e=Object.keys(t)[0];if(e){const i=(r=t[e])==null?void 0:r.lastUpdated;if(i)return`${new Date(i).toLocaleString("zh-CN",{hour12:!1})} (${a?"实时":"静态"})`}return"N/A"}async function T(){a&&u()}function A(){return{mode:a?"realtime":"static",available:d()}}export{A as a,R as b,$ as g,p as i,T as r,w as s};
