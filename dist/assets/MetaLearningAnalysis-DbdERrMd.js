import{j as e,m as S}from"./motion-Nujmgg1Y.js";import{r as n}from"./vendor-DJ1oPbzn.js";import{g as R}from"./dataLoader-oWN11X4O.js";import{o as k,L as A,k as E,l as _}from"./icons-CYvmV9N1.js";import{R as y,P as L,e as O,f as P,T as b,c as B,i as K,j as T,k as H,m as M}from"./charts-Cp_LfCcJ.js";const o=c=>(c==null?void 0:c.map(d=>d.plain_text).join(""))||"",p=({title:c,children:d,icon:m,color:h})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 h-full flex flex-col",children:[e.jsxs("div",{className:`flex items-center mb-4 ${h}`,children:[e.jsx(m,{className:"w-6 h-6 mr-3"}),e.jsx("h3",{className:"text-lg font-bold",children:c})]}),e.jsx("div",{className:"flex-grow",children:d})]}),N=["#0088FE","#00C49F","#FFBB28","#FF8042","#AF19FF"],I=()=>{const[c,d]=n.useState([]),[m,h]=n.useState([]),[v,w]=n.useState([]),[D,F]=n.useState([]),[C,f]=n.useState(!0);return n.useEffect(()=>{(async()=>{f(!0);const l=await R("成长复盘"),j={};l.forEach(t=>{var a,r;const s=(r=(a=t.properties.事件类型)==null?void 0:a.select)==null?void 0:r.name;s&&(j[s]=(j[s]||0)+1)}),d(Object.entries(j).map(([t,s])=>({name:t,value:s})));const x={};let g=0;l.forEach(t=>{var a;(((a=t.properties.能力提升)==null?void 0:a.multi_select)||[]).forEach(r=>{x[r.name]=(x[r.name]||0)+1,x[r.name]>g&&(g=x[r.name])})}),h(Object.entries(x).map(([t,s])=>({subject:t,count:s,fullMark:g+1}))),w(l.filter(t=>{var s,a;return((a=(s=t.properties.事件类型)==null?void 0:s.select)==null?void 0:a.name)==="失败"}).map(t=>{var s,a,r,u;return{event:o((s=t.properties.复盘事件)==null?void 0:s.title),lesson:o((a=t.properties.核心教训)==null?void 0:a.rich_text),blindSpot:o((r=t.properties.能力盲区)==null?void 0:r.rich_text),improvement:o((u=t.properties.下次改进)==null?void 0:u.rich_text)}})),F(l.filter(t=>{var s,a;return(((a=(s=t.properties.成长价值)==null?void 0:s.select)==null?void 0:a.name)||"").includes("5")}).sort((t,s)=>new Date(s.created_time).getTime()-new Date(t.created_time).getTime()).slice(0,3).map(t=>{var s,a;return{event:o((s=t.properties.复盘事件)==null?void 0:s.title),lesson:o((a=t.properties.核心教训)==null?void 0:a.rich_text)}})),f(!1)})()},[]),C?e.jsx("div",{className:"text-center p-8",children:"加载元认知分析数据中..."}):e.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"元认知提升分析"}),e.jsx(p,{title:"教训名人堂",icon:k,color:"text-yellow-600",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:D.map((i,l)=>e.jsxs("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-lg",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2 font-semibold",children:["来自: ",i.event]}),e.jsxs("p",{className:"text-lg text-gray-800 italic",children:['"',i.lesson,'"']})]},l))})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(p,{title:"成长事件类型分析",icon:A,color:"text-blue-600",children:e.jsx(y,{width:"100%",height:300,children:e.jsxs(L,{children:[e.jsx(O,{data:c,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:100,fill:"#8884d8",label:!0,children:c.map((i,l)=>e.jsx(P,{fill:N[l%N.length]},`cell-${l}`))}),e.jsx(b,{}),e.jsx(B,{})]})})}),e.jsx(p,{title:"能力提升雷达图",icon:E,color:"text-green-600",children:e.jsx(y,{width:"100%",height:300,children:e.jsxs(K,{cx:"50%",cy:"50%",outerRadius:"80%",data:m,children:[e.jsx(T,{}),e.jsx(H,{dataKey:"subject",tick:{fontSize:12}}),e.jsx(M,{name:"提升次数",dataKey:"count",stroke:"#10B981",fill:"#10B981",fillOpacity:.6}),e.jsx(b,{})]})})})]}),e.jsx(p,{title:"失败根本原因分析",icon:_,color:"text-red-600",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-gray-500",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3",children:"失败事件"}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:"核心教训"}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:"能力盲区"}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:"下次改进"})]})}),e.jsx("tbody",{children:v.map((i,l)=>e.jsxs("tr",{className:"bg-white border-b hover:bg-red-50",children:[e.jsx("th",{scope:"row",className:"px-4 py-4 font-medium text-gray-900",children:i.event}),e.jsx("td",{className:"px-4 py-4",children:i.lesson}),e.jsx("td",{className:"px-4 py-4 text-red-700 font-medium",children:i.blindSpot}),e.jsx("td",{className:"px-4 py-4 text-green-700 font-medium",children:i.improvement})]},l))})]})})})]})};export{I as default};
